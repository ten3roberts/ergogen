points:
  rotate: 14
  key:
    padding: cy
    footprints:
      switch:
        type: choc
        nets:
          from: =column_net
          to: GND
        params:
          hotswap: true
          reverse: true
          keycaps: true

      choc:
        type: choc
        anchor:
          rotate: 180
        nets:
          from: =column_net
          to: GND
        params:
            reverse: true
  zones:
    matrix:
      columns:
        pinky:
          rows:
            bottom.column_net: P18
            home.column_net: P9
            top.column_net: P4
        ring:
          rotate: -10
          spread: u + 1
          stagger: 7
          rows:
            bottom.column_net: P15
            home.column_net: P8
            top.column_net: P3
        middle: 
          rotate: -2
          stagger: 5
          rows:
            bottom.column_net: P14
            home.column_net: P7
            top.column_net: P2
        index:
          rotate: -2
          stagger: -5
          rows:
            bottom.column_net: P16
            home.column_net: P6
            top.column_net: P1
        inner:
          stagger: -5
          rows:
            bottom.column_net: P10
            home.column_net: P5
            top.column_net: P0
      rows:
        bottom:
        home:
        top:
    thumb:
      anchor:
        ref: matrix_inner_bottom
        shift: [ -18, -18 ]
      columns:
        outer:
          rotate: -5
          origin: [-9, -9 ]

          rows.main.column_net: P19
        middle:
          rotate: -10
          origin: [-9, -9]
          rows.main.column_net: P20
        inner:         
          rotate: -10
          origin: [-9, -9]
          rows.main.column_net: P21
      rows:
        main:

outlines:
  exports:
    plate:
      - type: "polygon"
        points:
          # Top left
          - ref: "matrix_pinky_top"
            shift: [ -.5cx - 1, .5cy + 5 ]
          - ref: "matrix_pinky_bottom"
            shift: [ -.5cx - 1, -.55cy ]
            # Left inset
          - ref: "thumb_outer_main"
            shift: [ -.5cx, -10 ]
            # Bottom right
          - ref: "thumb_inner_main"
            shift: [ .5cx + 1, -.55cy ]
          - ref: "thumb_inner_main"
            shift: [ .5cx + 1, .5cy ]
            # Top right
          - ref: "matrix_inner_top"
            shift: [ 1.5cx + 8, .5cy ]
          - ref: "matrix_middle_top"
            shift: [ .5cx + 1.5, .5cy + 1 ]
          - ref: matrix_middle_top
            shift: [ -.5cx - 1.5, .5cy + 1 ]
            # - type: "keys"
            #   side: "left"
            #   size: 16
            #   operation: "stack"
    fillet:
      - type: "outline"
        name: "plate"
        fillet: 2

pcbs.main:
  outlines.board:
    outline: fillet
  footprints:
    mcu:
      type: promicro_pretty
      anchor:
        ref: matrix_inner_top
        shift: [ u + 1, -.6u ]
        rotate: -90
    battery:
      type: bat
      nets: 
        neg: GND
      anchor:
        ref: matrix_inner_top
        shift: [u -7, -1.6u]
        rotate: 0
    power_switch:
      type: pcm12
      anchor:
        ref: matrix_inner_top
        shift: [2u - 5.5, -0u]
        rotate: 90
      nets:
        from: pos 
        to: RAW
      params:
        reverse: true
    reset_switch:
      type: b3u1000p
      nets:
        r1: RST  
        r2: GND
      anchor:
        ref: matrix_inner_top
        shift: [u + 6, -1.6u]
      params:
        reverse: true 
